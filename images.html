<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Token Image Uploader</title>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7; }
    .image-block { border: 1px solid #ccc; background: #fff; padding: 10px; margin-bottom: 15px; border-radius: 8px; }
    img { max-width: 100%; height: auto; display: block; margin-bottom: 10px; }
    button { margin-top: 5px; margin-right: 5px; }
    .token { font-weight: bold; background: #eee; padding: 4px 6px; border-radius: 5px; display: inline-block; margin-bottom: 6px; }
  </style>
</head>
<body>

<h2>Image Upload with Token Generator (GUN.js)</h2>

<input type="file" id="uploader" accept="image/*"><br><br>
<div id="images"></div>

<script>
  const gun = Gun(); // Start Gun (no peer needed for local memory)

  const uploader = document.getElementById('uploader');
  const imagesDiv = document.getElementById('images');

  uploader.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      const base64 = reader.result;
      const token = generateToken();
      gun.get('images').get(token).put({ base64 });
      alert("Image uploaded! Token: " + token);
    };
    reader.readAsDataURL(file);
  };

  function generateToken(length = 8) {
    return Math.random().toString(36).substring(2, 2 + length);
  }

  gun.get('images').map().on((data, token) => {
    if (!data || !data.base64) return;
    if (document.getElementById(`img-${token}`)) return;

    const block = document.createElement('div');
    block.className = 'image-block';
    block.id = `img-${token}`;
    block.innerHTML = `
      <img src="${data.base64}" alt="Uploaded Image">
      <div class="token">Token: ${token}</div>
      <button onclick="copyToken('${token}')">Copy Token</button>
      <button onclick="confirmDelete('${token}')">Delete</button>
      <span id="confirm-${token}"></span>
    `;
    imagesDiv.prepend(block);
  });

  function copyToken(token) {
    navigator.clipboard.writeText(token).then(() => {
      alert("Token copied: " + token);
    });
  }

  function confirmDelete(token) {
    const confirmBox = document.getElementById(`confirm-${token}`);
    confirmBox.innerHTML = `<button onclick="deleteImage('${token}')">Confirm Delete</button>`;
  }

  function deleteImage(token) {
    gun.get('images').get(token).put(null); // Removes the image
    const el = document.getElementById(`img-${token}`);
    if (el) el.remove();
  }
</script>

</body>
</html>
